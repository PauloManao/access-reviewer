<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Geocoding with Nominatim</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="" th:href="@{/styles.css}">
</head>
<body>

        <input id="close-menu" class="close-menu" type="checkbox" aria-label="Close menu" role="button">
        <label class="close-menu-label" for="close-menu" title="close menu"></label>
        <aside class="menu white-bg">
            <div class="main-content menu-content">
                <h1 onclick="getElementById('close-menu').checked=false">
                    <!--<a href="#">LOGO</a>--><img href="#" src="image/logo.png" alt="">
                </h1>
                <nav>
                    <ul onclick="getElementById('close-menu').checked=false">
                        <li><a th:href="@{/index}">Home</a></li>
                        <li><a th:href="@{/news}">News</a></li>
                        <li><a th:href="@{/about}">About</a></li>
                        <li><a th:href="@{/registration}">Login</a></li>
                        <li><a th:if="${username}" th:text="${username}" th:href="@{/user-page}"></a></li>
                    </ul>
                </nav>
            </div>
        </aside>
        
    <div class="menu-spacing"></div>

    <h1>Geocoding with Nominatim</h1>
 
    
    <div>
        <label for="searchTbx">Enter an address: </label>
        <input id="searchTbx" type="text">
        <button onclick="geocodeAddress()">Search</button>
    </div>
    
    <div id="output"></div>
    
 	<footer id="madeby-footer" class="madeby-footer main-bg">
	    <p>
	        <a href="#privacy" >Privacy Statement</a>
	        <a href="#term" >Term & Conditions</a>
	        <a href="#policy" >Cookie Policy</a>
	        <a href="#rights" >© 2023, Access Reviewer. All rights reserved</a>
	    </p>
    </footer>
    
        <a class="back-to-top" href="#">➤</a>

    <script>
    function geocodeAddress() {
        var query = document.getElementById('searchTbx').value;
        var url = `/geocode?query=${encodeURIComponent(query)}`;

        fetch(url)
            .then(response => response.json())
            .then(data => {
                var outputDiv = document.getElementById('output');
                outputDiv.innerHTML = '';

                if (data && data.length > 0) {
                    data.forEach(result => {
                        var addressDiv = document.createElement('div');
                        addressDiv.textContent = result.display_name;
                        addressDiv.style.cursor = "pointer";
                        addressDiv.addEventListener('click', function() {
                            openAddressPage(result.display_name, result.lat, result.lon);
                        });
                        outputDiv.appendChild(addressDiv);
                    });
                } else {
                    outputDiv.textContent = "Locations not found.";
                }
            })
            .catch(error => {
                console.error("Error fetching location data:", error);
            });
    }
    
	 // Enable pressing Enter to perform the search
	    document.getElementById('searchTbx').addEventListener('keydown', function(event) {
	        if (event.key === 'Enter') {
	            event.preventDefault(); // Prevent the default form submission
	            geocodeAddress(); // Call the geocodeAddress function
	        }
	    });

	    function openAddressPage(address, latitude, longitude) {
	        const queryString = `?address=${encodeURIComponent(address)}&lat=${latitude}&lon=${longitude}`;
	        window.open(`/details.html${queryString}`, "_blank");
	    }
    
    
    </script>
</body>
</html>
